<?xml version="1.0" encoding="windows-1252" ?>
<!--Ant buildfile generated by Oracle JDeveloper-->
<!--Generated Jul 27, 2014 10:40:30 PM-->
<project name="CarsMasterApplicationWorkspace">
    <!--Check params if set, fail otherwise-->
    <!--param: targetenv - mandatory to specify target environment DEV, PRD, UAT.-->
    <!--       wl_username - mandatory to specify deployment server username.-->
    <!--       wl_password - mandatory to specify deployment server password.-->

    <fail message="ERROR: Unspecified parameter detected">
        <condition>
            <or>
                <not>
                    <isset property="targetenv"/>
                </not>
                <not>
                    <isset property="wl_username"/>
                </not>
                <not>
                    <isset property="wl_password"/>
                </not>
                <equals arg1="${targetenv}" arg2=""/>
                <equals arg1="${wl_username}" arg2=""/>
                <equals arg1="${wl_password}" arg2=""/>
            </or>
        </condition>
</fail>

    
    
    <!--Test targetEnv and set appropriate value for the targetServer variable-->
    <target name="-setVars">
        <condition property="isdev">
            <equals arg1="${targetenv}" arg2="DEV"/>
        </condition>
        <condition property="isuat">
            <equals arg1="${targetenv}" arg2="UAT"/>
        </condition>
        <condition property="isprd">
            <equals arg1="${targetenv}" arg2="PRD"/>
        </condition>
    </target>
    <target name="-targetDev" if="isdev">
        <property name="targetServer" value="cssoady2"/>
        <property name="targetReportServer" value="csfmrdy2"/>
        <property name="targetReportFolder" value="\\csfmrdy2\CARS_TEST"/>
        <echo> DEV set as target </echo>
    </target>
    <target name="-targetUat" if="isuat">
        <property name="targetServer" value="cssoaxy2"/>
        <property name="targetReportServer" value="csfmrxy2"/>
        <property name="targetReportFolder" value="\\csfmrxy2\CARS_UAT\"/>
        <echo> UAT set as target </echo>
    </target>
    <target name="-targetPrd" if="isprd">
        <property name="targetServer" value="cssoapy1"/>
        <property name="targetReportServer" value="csfmrpy1"/>
        <property name="targetReportFolder" value="\\csfmrpy1\CARS\"/>
        <echo> PRD set as target </echo>
    </target>

    <target name="buildmodules" depends="-setVars,-targetDev,-targetUat,-targetPrd">

   
        <!--Point to correct report server-->
        <replaceregexp file="./ViewController/src/gov/ca/dir/acct/cars/adf/master/viewcontroller/ReportParameterBean.java" match="csfmr.y2" replace="${targetReportServer}"></replaceregexp>

        <!--Build components-->
        <!--Common Modules/APIs-->
        
        <ant dir="../CarsCommonCode/CarsFrameworkExtension" antfile="CarsFrameworkExtension-build.xml" target="deploy" inheritAll="false"/>
        <ant dir="../CarsInternalWebServiceInterface/CarsInternalWebservicesInterface" antfile="CarsInternalWebServiceInterface-vc-build.xml" target="all" inheritAll="false">
            <property file="targetenv" value="CarsInternalWebServiceInterface-vc-build.properties"/>
        </ant>
        <ant dir="../CarsCommonCode/CarsCommonCodeProject" antfile="CarsCommonCode-build.xml" target="deploy" inheritAll="false"/>
        <ant dir="../CarsCommonModel/CarsCommonModelProject" antfile="CarsCommonModel-build.xml" target="deploy" inheritAll="false"/>
        <ant dir="../CarsCommonUI/CarsCommonUIProject" antfile="CarsCommonUI-build.xml" target="deploy" inheritAll="false"/>
        
        <!--Modules-->
        <ant dir="../CarsUseCaseImplemations/UseCase001/UseCase001View" antfile="UseCase001-vc-build.xml" inheritAll="false">
                <target name="clean"/>
                <target name="deploy"/>
        </ant>
        <ant dir="../CarsUseCaseImplemations/UseCase004/UseCase004ViewController" antfile="UseCase004-vc-build.xml" inheritAll="false">
                <target name="clean"/>
                <target name="deploy"/>
        </ant>
        <ant dir="../CarsUseCaseImplemations/UseCase006/UseCase006View" antfile="UseCase006-vc-build.xml" inheritAll="false">
                <target name="clean"/>
                <target name="deploy"/>
        </ant>
        <ant dir="../CarsUseCaseImplemations/UseCase009/ViewController" antfile="UseCase009-vc-build.xml" inheritAll="false">
                <target name="clean"/>
                <target name="deploy"/>
        </ant>
        <ant dir="../CarsUseCaseImplemations/UseCase030/ViewController" antfile="UseCase030-vc-build.xml" inheritAll="false">
                <target name="clean"/>
                <target name="deploy"/>
        </ant>
        
        <!--Interactive Reports-->
        <ant dir="../../CarsReports/CarsInteractiveReports/cars01Report/ViewController" antfile="CarsReport01-vc-build.xml" inheritAll="false">
                <target name="clean"/>
                <target name="deploy"/>
        </ant>
        <ant dir="../../CarsReports/CarsInteractiveReports/cars02Report/ViewController" antfile="CarsReport02-vc-build.xml" inheritAll="false">
                <target name="clean"/>
                <target name="deploy"/>
        </ant>
        <ant dir="../../CarsReports/CarsInteractiveReports/cars03Report/ViewController" antfile="CarsReport03-vc-build.xml" inheritAll="false">
                <target name="clean"/>
                <target name="deploy"/>
        </ant>
        <ant dir="../../CarsReports/CarsInteractiveReports/cars04Report/ViewController" antfile="CarsReport04-vc-build.xml" inheritAll="false">
                <target name="clean"/>
                <target name="deploy"/>
        </ant>
        <ant dir="../../CarsReports/CarsInteractiveReports/cars06report/ViewController" antfile="CarsReport06-vc-build.xml" inheritAll="false">
                <target name="clean"/>
                <target name="deploy"/>
        </ant>
        <ant dir="../../CarsReports/CarsInteractiveReports/cars08report/ViewController" antfile="CarsReport08-vc-build.xml" inheritAll="false">
                <target name="clean"/>
                <target name="deploy"/>
        </ant>
        <ant dir="../../CarsReports/CarsInteractiveReports/cars10Report/ViewController" antfile="CarsReport10-vc-build.xml"  inheritAll="false">
                <target name="clean"/>
                <target name="deploy"/>
        </ant>
        <ant dir="../../CarsReports/CarsInteractiveReports/cars11Report/ViewController" antfile="CarsReport11-vc-build.xml"  inheritAll="false">
                <target name="clean"/>
                <target name="deploy"/>
        </ant>
        <ant dir="../../CarsReports/CarsInteractiveReports/cars12Report/ViewController" antfile="CarsReport12-vc-build.xml" inheritAll="false">
                <target name="clean"/>
                <target name="deploy"/>
        </ant>
        <ant dir="../../CarsReports/CarsInteractiveReports/cars13Report/ViewController" antfile="CarsReport13-vc-build.xml" inheritAll="false">
                <target name="clean"/>
                <target name="deploy"/>
        </ant>
        <ant dir="../../CarsReports/CarsInteractiveReports/cars14Report/ViewController" antfile="CarsReport14-vc-build.xml" inheritAll="false">
                <target name="clean"/>
                <target name="deploy"/>
        </ant>
        <ant dir="../../CarsReports/CarsInteractiveReports/cars16Report/ViewController" antfile="CarsReport16-vc-build.xml" inheritAll="false">
                <target name="clean"/>
                <target name="deploy"/>
        </ant>
       <ant dir="../../CarsReports/CarsInteractiveReports/cars20report/ViewController" antfile="CarsReport20-vc-build.xml" inheritAll="false">
                <target name="clean"/>
                <target name="deploy"/>
        </ant>
        
     </target>
  
    <property file="carsmasteraapplication-app-build.properties"/>
    <property name="workspace.dir" location="."/>
    <target name="deploy" description="Deploy JDeveloper profiles" depends="-setVars,-targetDev,-targetUat,-targetPrd,buildmodules">
        <taskdef name="ojdeploy" classname="oracle.jdeveloper.deploy.ant.OJDeployAntTask" uri="oraclelib:OJDeployAntTask" classpath="${oracle.jdeveloper.ant.library}"/>
        <ora:ojdeploy xmlns:ora="oraclelib:OJDeployAntTask" executable="${oracle.jdeveloper.ojdeploy.path}" ora:buildscript="${oracle.jdeveloper.deploy.dir}/ojdeploy-build.xml"
                      ora:statuslog="${oracle.jdeveloper.deploy.dir}/ojdeploy-statuslog.xml">
            <ora:deploy>
                <ora:parameter name="forcerewrite" value="true"/>
                <ora:parameter name="workspace" value="${workspace.dir}${oracle.jdeveloper.workspace.path}"/>
                <ora:parameter name="profile" value="${oracle.jdeveloper.deploy.profile.name}"/>
                <ora:parameter name="outputfile" value="${oracle.jdeveloper.deploy.outputfile}"/>
            </ora:deploy>
        </ora:ojdeploy>
    </target>
    <taskdef name="wldeploy" classname="weblogic.ant.taskdefs.management.WLDeploy">
        <classpath>
            <pathelement location="C:\oracle\Middleware\wlserver_10.3\server\lib\weblogic.jar"/>
        </classpath>
    </taskdef>
    <!--deploy static reports-->
    <target name="deploystaticreports" depends="-setVars,-targetDev,-targetUat,-targetPrd">
        <echo> Deploying static reports ... </echo>
        <copy todir="${targetReportFolder}">
            <fileset dir="..\..\CarsReports\CarsStaticReports\" includes="*.rdf"/>
        </copy>
        <echo> Deploying static reports completed ...</echo>
    </target>
    <!--undeploy from server identified by targetServer-->  
     <target name="undeployfromserver" depends="-setVars,-targetDev,-targetUat,-targetPrd">
        <!-- -->
        <echo> Undeploying from ${targetServer} </echo>
        <wldeploy action="undeploy" verbose="true"  name="CARSMasterApp" failonerror="false"
                  user="${wl_username}" password="${wl_password}" adminurl="t3://${targetServer}:7001/" targets="adf_cluster1"/>
    </target> 
    
    <!--target to mds identified by targetServer bug exists in 11g, 
    have to manually add unzip/replace/zip to add persdef as namespace-->  
    <target name="targetapptomds" >
        <echo> Targetting new build to MDS: ${targetServer} </echo>
        <exec executable="${oracle.wlst.path}"
          spawn="false" failonerror="true">
            <!-- Python Script Relative Path from carsmasteraapplication-app-build.xml In this case both
            reside in the same folder-->
            <arg value="target-app-to-mds.py"/>
            <!-- Application ear Path -->
            <arg value="${cars.mds.earfilelocation}"/>
            <!-- Application Name -->
            <arg value="oracle.jdeveloper.deploy.profile.name"/>
            <!-- MDS Repository Name -->
            <arg value="${cars.mds.repository}"/>
            <!-- MDS Partition Name -->
            <arg value="${cars.mds.repository.partition}"/>
            <!-- Repository type (DB/file) -->
            <arg value="${cars.mds.repository.type}"/>
            <!-- Repository JNDI. See WLS EM console -->
            <arg value="${cars.mds.repository.jndi}"/>
        </exec>
        <unzip src="${cars.mds.earfilelocation}" dest="${cars.mds.workingdir}"/>
        <condition property="addpersdef">
            <not>
                <resourcecontains resource="${cars.mds.adfconfiglocation}" substring="/persdef"/>
            </not>
    	</condition>
    </target>
    <target name="add-persdef-namespace" if="addpersdef">
        <!--Remove below if a later version of adf fixes this-->
        <replace file="${cars.mds.adfconfiglocation}">
            <replacefilter token="${cars.mds.adfconfigreplacestringof}"
                 value="${cars.mds.adfconfigreplacestringwith}"/>
         </replace>
         <zip destfile="${cars.mds.earfilelocation}"
            basedir="${cars.mds.workingdir}"/>
    </target>
    <!--deploy to server identified by targetServer-->  
    <target name="deploytoserver" depends="undeployfromserver, deploy,-setVars,-targetDev,-targetUat,-targetPrd,deploystaticreports,targetapptomds,add-persdef-namespace">
        <!-- -->
        <echo> Deploying new build to ${targetServer} </echo>
        <copy file="C:\Temp\carslibrary\CARSMasterApp.ear" todir="\\${targetServer}\deploy\CARSMasterApp\"/>
        <wldeploy action="deploy" verbose="true" debug="true" name="CARSMasterApp" nostage="true" timeout="3600" source="\\${targetServer}\deploy\CARSMasterApp\CARSMasterApp.ear"
                  user="${wl_username}" password="${wl_password}" adminurl="t3://${targetServer}:7001/" targets="adf_cluster1"/>
    </target>
    <target name="redeploytoserver" depends="deploy,-setVars,-targetDev,-targetUat,-targetPrd,deploystaticreports">
        <!-- -->
        <echo> Redeploying new build to ${targetServer} </echo>
        <copy file="C:\Temp\carslibrary\CARSMasterApp.ear" todir="\\${targetServer}\deploy\CarsMasterApp\"/>
        <wldeploy action="redeploy" verbose="true" debug="true" name="CARSMasterApp" source="\\${targetServer}\deploy\CARSMasterApp\CARSMasterApp.ear"
                  user="${wl_username}" password="${wl_password}" adminurl="t3://${targetServer}:7001/" targets="adf_cluster1"/>
    </target>
    <target name="deploytoservernorebuild" depends="undeployfromserver,-setVars,-targetDev,-targetUat,-targetPrd,deploystaticreports">
        <echo> Deploying current build to ${targetServer} </echo>
        <wldeploy action="deploy" verbose="true" debug="true" name="CARSMasterApp" nostage="true" timeout="3600" source="\\${targetServer}\deploy\CARSMasterApp\CARSMasterApp.ear"
                  user="${wl_username}" password="${wl_password}" adminurl="t3://${targetServer}:7001/" targets="adf_cluster1"/>
    </target>
    <target name="redeploytoservernorebuild" depends="-setVars,-targetDev,-targetUat,-targetPrd,deploystaticreports">
        <echo> Redeploying current build to ${targetServer} </echo>
        <wldeploy action="redeploy" verbose="true" debug="true" name="CARSMasterApp"  source="\\${targetServer}\deploy\CARSMasterApp\CARSMasterApp.ear"
                  user="${wl_username}" password="${wl_password}" adminurl="t3://${targetServer}:7001/" targets="adf_cluster1"/>
    </target>
</project>
